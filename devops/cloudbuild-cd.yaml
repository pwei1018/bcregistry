steps:
  # install / setup ci
  - name: $DEPLOYMENT_NODE_VERSION
    entrypoint: npm
    args: ['install']

  #
  # Generate the statis site
  #
  - name: $DEPLOYMENT_NODE_VERSION
    entrypoint: npm
    args: ['--openssl-legacy-provider', 'run', 'generate']

  #
  # Deploy to firebase channel, using the PR #
  # store log to /workspace to get the channel URL
  #
  - name: gcr.io/$_DEPLOYMENT_PROJECT/firebase
    entrypoint: bash
    args: ['-c', 'firebase deploy --project=$_DEPLOYMENT_PROJECT--config=firebase.json --only hosting:$DEPLOYMENT_HOST_NAME']

substitutions:
    _DEPLOYMENT_PROJECT: '${_DEPLOYMENT_PROJECT}'
    _DEPLOYMENT_NODE_VERSION: '${_DEPLOYMENT_NODE_VERSION}'
    _DEPLOYMENT_HOST_NAME: '${_DEPLOYMENT_HOST_NAME}'


options:
  logging: CLOUD_LOGGING_ONLY